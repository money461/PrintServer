<#include "/system/include.html" encoding="UTF-8" parse=true/>
<!DOCTYPE html>
<html lang="zh">
<head>
	<!-- 引入样式css -->
	<@commoncss title='添加打印标签模板'/>
</head>
<body class="white-bg">
	<div class="wrapper wrapper-content animated fadeInRight ibox-content">
		<form class="form-horizontal m" id="form-post-add">
			<div class="form-group">
				<label class="col-sm-3 control-label">模板名称：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" name="templateName" id="templateName" style="display: none;" required>
					<input class="select2 form-control" type="text" id='moban' href='/labelPrint/template/getUserAuthenTemplate' inputMessage="请输入或选择打印模板" >
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label ">模板编码：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" placeholder="模板编号请先注册模板权限系统获取编码" name="templateId" id="templateId"  readonly="true" required>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">打印宽度：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" placeholder="单位-毫米 默认100mm" name="width" id="width" required>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">打印高度：</label>
				<div class="col-sm-8">
					<input class="form-control" type="text" placeholder="单位-毫米 默认100mm" name=height id="height" required>
				</div>
			</div>
			
			<div class="form-group">
				<label class="col-sm-3 control-label">打印标签：</label>
				<div class="col-sm-8">
				 	 <input class="form-control" type="text" style="display: none;" id='codeName' name="codeName"  required />
				     <input class="select2 form-control" id='biaoqian' type="text" href='/labelPrint/template/getAllCode' inputMessage="请输入或选择打印标签" required>
				     </input>
				</div>
			</div>
			
			<div class="form-group">
				<label class="col-sm-3 control-label">标签code：</label>
				<div class="col-sm-8">
				     <input class="form-control" type="text"   id='code' name="code" readonly="true"  readonly="true" required>
				     </input>
				</div>
			</div>
			
			<div class="form-group" id='isDefault'>
				<label class="col-sm-3 control-label">是否绑定：</label>
				<div class="col-sm-8">
					<div class="radio-box">
						<div class="iradio-blue"><input type="radio" id="6" name="isDefault" value="0" checked="checked" /></div>
						<label for="6" class="">绑定</label>
					</div>
					<div class="radio-box">
						<div class="iradio-blue"><input type="radio" id="7" name="isDefault" value="1"/></div>
						<label for="7" class="">不绑定</label>
					</div>
				</div>
			</div>
			<div class="form-group" id='status' style="display: none;">
				<label class="col-sm-3 control-label">使用状态：</label>
				<div class="col-sm-8">
					<div class="radio-box">
						<div class="iradio-blue"><input type="radio" id="6" name="status" value="0" checked="checked" /></div>
						<label for="6" class="">正常</label>
					</div>
					<div class="radio-box">
						<div class="iradio-blue"><input type="radio" id="7" name="status" value="1"/></div>
						<label for="7" class="">停用</label>
					</div>
				</div>
			</div>
		</form>
	</div>
		<!-- 引入通用js -->
	<@commonjs/>
	<!-- js -->
	<script src="${request.contextPath}/js/admin/labeltemplate.js"></script>
	
	<script  type="text/javascript">
	
		var prefix = ctx + "/template";
		
		$("#form-post-add").validate({
			onkeyup: false,
        	rules:{
	        	 code:{ 
	        		 required: true
	        	 },
	        	 height:{digits:true},
	        	 width:{digits:true},
	        	 isDefault:{
					 remote: {
				                url: prefix + "/checkCodeBindTemplateUnique", //校验字段唯一
				                type: "post",
				                dataType: "json",
				                async: false,
				                data: {
					                	"templateId":function(){return $("#templateId").val()},
					                	"code": function() {
					                		//return $("input[name='regionCode']").val(); //取出办公室简码
					                		return $.common.trim( $("#code option:checked").text())
					                    },
					                    "isDefault":function(){return $("input[name='isDefault']:checked").val()}
				                	
				                      },
                    			 dataFilter: function(data, type) { //后台返回0 不存在    返回1 存在
                	                 return $.validate.unique(data); // 判断返回标识是否唯一 1->false 不存在   0->true 存在
                               }
						     }
                }
        	},
        	messages: {
        		code :"请输入业务code",
        		isDefault:"业务code已经默认绑定了其它模板！"
            },
            focusCleanup: true
			
		});
		
		function submitHandler() {
			 if ($.validate.form()) {
				//var param = $('#form-post-add').serialize();
				var param = $.common.formToJSON('form-post-add');
				console.log(param);
				if($.common.isEmpty(param.code)){
					$.modal.msgError('业务code不能为空！');
					return;
				}
				labeltemplate.saveorupdatetemplate(prefix + "/saveorupdateTempalte",param);
				 
			 }
	    }
		
		function selected(data,id){
			if('moban'==id){
				$("#templateId").val(data.id);
				$("#templateName").val(data.text);
			}else if('biaoqian'==id){
				$("#code").val(data.id);
				$("#codeName").val(data.text);
			}
		}
		
		$(function() {
			  labeltemplate.select2('moban',null,selected);
			  labeltemplate.select2('biaoqian',null,selected);
			 //labeltemplate.initCode2(prefix+'/getAllCode',null,null);
		});
		
	</script>
</body>
</html>
